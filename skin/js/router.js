!function(){function t(){}function r(t){if(""===t)return!1;var r=t.substr(1),n=r.indexOf("?"),o={},a="";if(n>-1){var i=r.split("?");a=i[0];var u=i[1];o=e(u)}else a=r,o={};var p=a.split("/");return{path:a,routers:p,param:o}}function e(t){var r=t.split("&"),e={};return r.forEach(function(t){var r,n,o=t.split("=");r=o[0],n=o[1],""!==r&&(e[r]=decodeURIComponent(n))}),e}function n(t){var r=(t.path,t.routers);t.param;if(!t){var e=vipspa.routerMap.defaults,n=vipspa.routerMap[e];return a(vipspa.mainView,n),location.hash=e,!1}if(1===r.length){var i=r[0],n=vipspa.routerMap[i];if("undefined"==typeof n)return console.error("路由匹配失败，请检查。",t),!1;if(null===d)return a(vipspa.mainView,n),d=t,!1;var u=d.routers[0]!==t.routers[0];if(u)a(vipspa.mainView,n);else{var i=d.routers[0],p=d.routers[1],s=n.subView,c=n.children,l=o(c,p);a(s,{},function(){},!0)}d=t}else if(2===r.length){var u=!0;null===d?d=t:(u=d.routers[0]!==t.routers[0],d=t);var i=r[0],p=r[1],n=vipspa.routerMap[i];if("undefined"==typeof n)return console.error("路由匹配失败，请检查。",t),!1;var s=n.subView,c=n.children,l=o(c,p);if("undefined"==typeof n)return console.error("子路由匹配失败，请检查。",t),!1;u?a(vipspa.mainView,n,function(){a(s,l)}):a(s,l)}}function o(t,r){var e=null;return t.forEach(function(t){t.name===r&&(e=t)}),e}function a(t,r,e,n){if(n)return void i(t);var o=f(r.templateUrl);o?s(t,r,e):p(t,r,e)}function i(t){$(t).html("")}function u(t,r,e){$.ajax({type:"GET",url:t,dataType:"html",success:function(t,e,n){r&&r(t)},error:function(t,r,n){if(e&&e(),0===$(vipspa.errorTemplateId).length)return!1;var o=$(vipspa.errorTemplateId).html();o=o.replace(/{{errStatus}}/,t.status),o=o.replace(/{{errContent}}/,t.responseText),$(vipspa.mainView).html(o)}})}function p(t,r,e){u(r.templateUrl,function(n){$(t).html(n),h(r.controller),l(r.templateUrl,n),e&&e()})}function s(t,r,e){var n=c(r.templateUrl);$(t).html(n),h(r.controller),e&&e()}function c(t){for(var r,e=0;e<vipspa.catchHtmls.length;e++)if(r=vipspa.catchHtmls[e],r.routerUrl===t)return r.htmls;return""}function l(t,r){var e={routerUrl:t,htmls:r};vipspa.catchHtmls.push(e)}function f(t){for(var r,e=0;e<vipspa.catchHtmls.length;e++)if(r=vipspa.catchHtmls[e],r.routerUrl===t)return!0;return!1}function v(){var t=location.hash,r=vipspa.parse(t);n(r)}function h(t,r){var e,n=document.createElement("script");n.setAttribute("src",t),n.onreadystatechange=n.onload=function(){n.onreadystatechange=null,document.documentElement.removeChild(n),n=null,e||"function"==typeof r&&r(),e=!0},document.documentElement.appendChild(n)}t.prototype.start=function(t){var r=this;r.routerMap=t.router,r.mainView=t.view,r.errorTemplateId=t.errorTemplateId,r.catchHtmls=[],v(),window.onhashchange=function(){v()}};var m=[],d=null;t.prototype.getMessage=function(t){var r={};return $.each(m,function(e,n){n.id===t&&(r=n)}),r},t.prototype.setMessage=function(t){var r=JSON.parse(JSON.stringify(t));$.each(m,function(t,e){if(e.id===r.id)return e=r,!1}),m.push(r)},t.prototype.delMessage=function(t){if("undefined"==typeof t)return!1;var r=0;$.each(m,function(e,n){n.id===t&&(r=e)}),$.each(m,function(t,e){t>r&&(m[t-1]=e)})},t.prototype.clearMessage=function(t){m=[]},t.prototype.stringify=function(t,r){var e,n="";for(var o in r)n+=o+"="+encodeURIComponent(r[o])+"&";return""===n?e=t:(n=n.substring(0,n.length-1),e=t+"?"+n),e},t.prototype.parse=function(t){var e="undefined"==typeof t?location.hash:t,n=r(e);return n},window.vipspa=new t}();